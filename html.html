<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Temporal Anchor Calculation - Puzzle Tool</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      margin: 0;
      padding: 20px;
    }
    
    .container {
      background: rgba(20, 20, 30, 0.9);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(108, 140, 255, 0.3);
      max-width: 1000px;
      width: 100%;
    }
    
    h1 {
      color: #6c8cff;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
      text-shadow: 0 0 10px rgba(108, 140, 255, 0.3);
    }
    
    .main-content {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .left-panel {
      flex: 1;
    }
    
    .right-panel {
      flex: 1;
    }
    
    .rules {
      background: rgba(40, 40, 55, 0.8);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: left;
      border-left: 4px solid #6c8cff;
    }
    
    .rules h3 {
      color: #8ab4f8;
      margin-top: 0;
      margin-bottom: 15px;
    }
    
    .rules ul, .rules ol {
      color: #c0c0e0;
      padding-left: 20px;
      margin-bottom: 10px;
    }
    
    .rules li {
      margin-bottom: 8px;
      line-height: 1.5;
      font-size: 14px;
    }
    
    .number-item {
      background: rgba(40, 40, 55, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid rgba(108, 140, 255, 0.2);
    }
    
    .number-item strong {
      color: #8ab4f8;
    }
    
    .english-number {
      color: #ffffff !important;
      font-weight: normal;
      display: block;
      margin-top: 5px;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .vowel-table {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
      background: rgba(40, 40, 55, 0.8);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .vowel-table th {
      background: rgba(108, 140, 255, 0.3);
      color: #8ab4f8;
      padding: 12px;
    }
    
    .vowel-table td {
      padding: 12px;
      color: #c0c0e0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }
    
    .calculator {
      background: rgba(30, 30, 45, 0.9);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(108, 140, 255, 0.3);
    }
    
    .calculator-screen {
      width: 100%;
      height: 60px;
      font-size: 24px;
      text-align: right;
      padding: 10px 15px;
      margin-bottom: 20px;
      background: rgba(20, 20, 30, 0.8);
      border: 2px solid #6c8cff;
      border-radius: 8px;
      color: #ffffff;
      outline: none;
    }
    
    .calculator-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    
    .calc-btn {
      height: 60px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      background: rgba(60, 60, 80, 0.9);
      color: #e0e0e0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .calc-btn:hover {
      background: rgba(80, 80, 100, 0.9);
      transform: translateY(-2px);
    }
    
    .calc-btn.operator {
      background: rgba(74, 95, 193, 0.8);
      color: white;
    }
    
    .calc-btn.operator:hover {
      background: rgba(94, 115, 213, 0.9);
    }
    
    .calc-btn.equal {
      background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
      color: white;
      grid-column: span 2;
    }
    
    .calc-btn.equal:hover {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
    }
    
    .calc-btn.clear {
      background: linear-gradient(135deg, #c62828 0%, #f44336 100%);
      color: white;
    }
    
    .calc-btn.clear:hover {
      background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
    }
    
    .notes {
      background: rgba(40, 40, 55, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid rgba(108, 140, 255, 0.2);
    }
    
    .notes h4 {
      color: #8ab4f8;
      margin-top: 0;
    }
    
    .notes ul {
      color: #c0c0e0;
      padding-left: 20px;
      margin: 0;
    }
    
    .notes li {
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .answer-section {
      margin-top: 30px;
      padding: 25px;
      background: rgba(40, 40, 55, 0.8);
      border-radius: 10px;
      text-align: center;
      border: 1px solid rgba(108, 140, 255, 0.3);
    }
    
    .answer-label {
      color: #8ab4f8;
      margin-bottom: 15px;
      font-size: 18px;
      display: block;
    }
    
    .password-input {
      width: 80px;
      height: 80px;
      font-size: 48px;
      text-align: center;
      background: rgba(30, 30, 45, 0.8);
      border: 3px solid #6c8cff;
      border-radius: 10px;
      color: #ffffff;
      margin: 10px auto;
      display: block;
      outline: none;
      transition: all 0.3s ease;
    }
    
    .password-input:focus {
      border-color: #8ab4f8;
      box-shadow: 0 0 15px rgba(108, 140, 255, 0.5);
      transform: scale(1.05);
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #4a5fc1 0%, #6c8cff 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    
    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    
    .success {
      background: rgba(46, 125, 50, 0.2);
      color: #4caf50;
      border: 2px solid #4caf50;
    }
    
    .error {
      background: rgba(198, 40, 40, 0.2);
      color: #f44336;
      border: 2px solid #f44336;
    }
    
    .step-guide {
      background: rgba(40, 40, 55, 0.8);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid rgba(108, 140, 255, 0.2);
    }
    
    .step-guide h4 {
      color: #8ab4f8;
      margin-top: 0;
    }
    
    .step-guide ol {
      color: #c0c0e0;
      padding-left: 20px;
      margin: 0;
    }
    
    .step-guide li {
      margin-bottom: 8px;
    }
    
    .hint-section {
      background: rgba(60, 40, 60, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid rgba(255, 108, 255, 0.3);
    }
    
    .hint-section h4 {
      color: #ff8aff;
      margin-top: 0;
    }
    
    .hint-section p {
      color: #e0c0e0;
      margin: 5px 0;
      font-size: 14px;
    }
    
    .important-note {
      background: rgba(60, 60, 40, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid rgba(255, 255, 108, 0.3);
    }
    
    .important-note h4 {
      color: #ffff8a;
      margin-top: 0;
    }
    
    .important-note p {
      color: #e0e0c0;
      margin: 5px 0;
      font-size: 14px;
    }
    
    .anti-guess {
      background: rgba(40, 60, 60, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid rgba(108, 255, 255, 0.3);
      text-align: center;
    }
    
    .anti-guess h4 {
      color: #8affff;
      margin-top: 0;
    }
    
    .anti-guess p {
      color: #c0e0e0;
      margin: 5px 0;
      font-size: 14px;
    }
    
    .attempt-counter {
      color: #ff8a8a;
      font-size: 14px;
      margin-top: 10px;
    }
    
    .timeout-message {
      color: #ff8a8a;
      font-size: 16px;
      margin-top: 10px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    
    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .password-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #666 !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üï∞Ô∏è Temporal Anchor Calculation - Puzzle Tool</h1>
    
    <div class="main-content">
      <div class="left-panel">
        <div class="rules">
          <h3>üìù Mission Rules</h3>
          <ol>
            <li><strong>Three English Numbers:</strong>
              <ul>
                <li>five thousand and six hundred and twenty-eight</li>
                <li>seven thousand and nine hundred and forty-three</li>
                <li>four thousand and three hundred and nineteen</li>
              </ul>
            </li>
            <li><strong>Letter Values:</strong> A=1, B=2, C=3 ... Z=26</li>
            <li><strong>Vowel Rule:</strong> Calculate only vowel letters (A, E, I, O, U) numerical sum</li>
            <li><strong>Value Calculation:</strong>
              <ul>
                <li>If vowel sum is prime ‚Üí Value = vowel sum</li>
                <li>If vowel sum is composite ‚Üí Value = digital root (sum digits until single digit)</li>
              </ul>
            </li>
            <li><strong>Final Rule:</strong> Multiply three word values, take product's units digit -1 as second password</li>
          </ol>
        </div>
        
        <div class="important-note">
          <h4>‚ö†Ô∏è Important Note</h4>
          <p>NOT converting English numbers to Arabic numbers and adding!</p>
          <p>Instead: Find <strong>vowel letters</strong> in the English spelling,</p>
          <p>then <strong>add</strong> their corresponding values.</p>
          <p>Example: "five" has vowels i(9) and e(5), sum is 14</p>
        </div>
        
        <div class="step-guide">
          <h4>üßÆ Calculation Steps</h4>
          <ol>
            <li>Write each number's full English spelling (remove spaces/hyphens)</li>
            <li>Find all vowel letters (A, E, I, O, U)</li>
            <li>Calculate each vowel's numerical sum</li>
            <li>Check if sum is prime or composite</li>
            <li>Determine final value (prime sum or digital root)</li>
            <li>Multiply three values</li>
            <li>Take units digit -1 as password</li>
          </ol>
        </div>
        
        <table class="vowel-table">
          <tr>
            <th>Vowel</th>
            <th>Value</th>
            <th>Vowel</th>
            <th>Value</th>
          </tr>
          <tr>
            <td>A</td>
            <td>1</td>
            <td>O</td>
            <td>15</td>
          </tr>
          <tr>
            <td>E</td>
            <td>5</td>
            <td>U</td>
            <td>21</td>
          </tr>
          <tr>
            <td>I</td>
            <td>9</td>
            <td></td>
            <td></td>
          </tr>
        </table>
        
        <div class="hint-section">
          <h4>üí≠ Calculation Hints</h4>
          <p><strong>First Number:</strong></p>
          <p>five thousand and six hundred and twenty-eight</p>
          <p>Spelling: fivethousandsixhundredtwentyeight (remove spaces/hyphens)</p>
          <p><strong>Vowel letters:</strong> i, e, o, u, a, e, e, e, e, i, e, e, i, e</p>
          <p>Corresponding values: 9, 5, 15, 21, 1, 5, 5, 5, 5, 9, 5, 5, 9, 5</p>
        </div>
        
        <div class="anti-guess">
          <h4>üîí Anti-Guessing System</h4>
          <p>Multiple incorrect attempts will trigger a timeout.</p>
          <p>Please calculate carefully before submitting!</p>
          <div class="attempt-counter" id="attempt-counter">Attempts remaining: 5</div>
        </div>
      </div>
      
      <div class="right-panel">
        <div class="calculator">
          <input type="text" class="calculator-screen" id="calc-screen" disabled>
          <div class="calculator-buttons">
            <button class="calc-btn clear" onclick="clearScreen()">C</button>
            <button class="calc-btn" onclick="deleteLast()">‚å´</button>
            <button class="calc-btn operator" onclick="appendToScreen('/')">√∑</button>
            <button class="calc-btn operator" onclick="appendToScreen('*')">√ó</button>
            
            <button class="calc-btn" onclick="appendToScreen('7')">7</button>
            <button class="calc-btn" onclick="appendToScreen('8')">8</button>
            <button class="calc-btn" onclick="appendToScreen('9')">9</button>
            <button class="calc-btn operator" onclick="appendToScreen('-')">-</button>
            
            <button class="calc-btn" onclick="appendToScreen('4')">4</button>
            <button class="calc-btn" onclick="appendToScreen('5')">5</button>
            <button class="calc-btn" onclick="appendToScreen('6')">6</button>
            <button class="calc-btn operator" onclick="appendToScreen('+')">+</button>
            
            <button class="calc-btn" onclick="appendToScreen('1')">1</button>
            <button class="calc-btn" onclick="appendToScreen('2')">2</button>
            <button class="calc-btn" onclick="appendToScreen('3')">3</button>
            <button class="calc-btn" onclick="appendToScreen('(')">(</button>
            
            <button class="calc-btn" onclick="appendToScreen('0')">0</button>
            <button class="calc-btn" onclick="appendToScreen('.')">.</button>
            <button class="calc-btn" onclick="appendToScreen(')')">)</button>
            <button class="calc-btn equal" onclick="calculate()">=</button>
          </div>
        </div>
        
        <div class="number-item">
          <strong>Number 1:</strong>
          <span class="english-number">five thousand and six hundred and twenty-eight</span>
        </div>
        
        <div class="number-item">
          <strong>Number 2:</strong>
          <span class="english-number">seven thousand and nine hundred and forty-three</span>
        </div>
        
        <div class="number-item">
          <strong>Number 3:</strong>
          <span class="english-number">four thousand and three hundred and nineteen</span>
        </div>
        
        <div class="answer-section">
          <label class="answer-label">After calculation, enter the second password:</label>
          <input type="text" 
                 id="password-input" 
                 class="password-input" 
                 maxlength="1" 
                 inputmode="numeric"
                 pattern="[0-9]"
                 autocomplete="off">
          
          <button class="submit-btn" onclick="checkPassword()" id="submit-btn">Verify Answer</button>
          
          <div id="result-message" class="result"></div>
          <div id="timeout-message" class="timeout-message"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Calculator functions
    const screen = document.getElementById('calc-screen');
    const passwordInput = document.getElementById('password-input');
    const submitBtn = document.getElementById('submit-btn');
    const resultDiv = document.getElementById('result-message');
    const timeoutDiv = document.getElementById('timeout-message');
    const attemptCounter = document.getElementById('attempt-counter');
    
    // Anti-guessing system
    let attemptsRemaining = 3;
    let isLocked = false;
    let lockTimeout = null;
    let canSubmit = true; // Èò≤Ê≠¢ÈáçË§áÊèê‰∫§
    
    // Check if character is operator
    function isOperator(char) {
      return ['+', '-', '*', '/', '√ó', '√∑'].includes(char);
    }
    
    // Get last character
    function getLastChar(str) {
      return str.length > 0 ? str[str.length - 1] : '';
    }
    
    function appendToScreen(value) {
      const currentValue = screen.value;
      const lastChar = getLastChar(currentValue);
      
      // Prevent multiple consecutive operators
      if (isOperator(value) && isOperator(lastChar)) {
        // If current input is operator and last char is also operator, replace last operator
        screen.value = currentValue.slice(0, -1) + value;
      } 
      // Prevent multiple decimal points
      else if (value === '.' && lastChar === '.') {
        return; // No consecutive decimals
      }
      // Prevent decimal point followed directly by operator
      else if (isOperator(value) && lastChar === '.') {
        return; // No decimal followed by operator
      }
      // Prevent operator followed directly by decimal (except minus, which could be negative number)
      else if (value === '.' && isOperator(lastChar) && lastChar !== '-') {
        return; // No operator followed by decimal
      }
      else {
        screen.value += value;
      }
    }
    
    function clearScreen() {
      screen.value = '';
    }
    
    function deleteLast() {
      screen.value = screen.value.slice(0, -1);
    }
    
    function calculate() {
      try {
        // Replace symbols for JavaScript syntax
        let expression = screen.value.replace(/√ó/g, '*').replace(/√∑/g, '/');
        
        // Check if expression is valid
        if (!expression.trim()) {
          screen.value = 'Error';
          return;
        }
        
        // Check if ends with operator
        const lastChar = getLastChar(expression);
        if (isOperator(lastChar) || lastChar === '.') {
          screen.value = 'Error';
          return;
        }
        
        // Check parentheses matching
        let bracketCount = 0;
        for (let char of expression) {
          if (char === '(') bracketCount++;
          if (char === ')') bracketCount--;
          if (bracketCount < 0) {
            screen.value = 'Error';
            return;
          }
        }
        if (bracketCount !== 0) {
          screen.value = 'Error';
          return;
        }
        
        const result = eval(expression);
        
        // Check if result is valid
        if (isNaN(result) || !isFinite(result)) {
          screen.value = 'Error';
        } else {
          // If integer, don't show decimal point
          screen.value = Number.isInteger(result) ? result : parseFloat(result.toFixed(10));
        }
      } catch (error) {
        screen.value = 'Error';
      }
    }
    
    // Lock system functions
    function lockSystem(seconds) {
      isLocked = true;
      passwordInput.disabled = true;
      submitBtn.disabled = true;
      passwordInput.style.borderColor = "#ff8a8a";
      passwordInput.style.backgroundColor = "rgba(60, 30, 30, 0.8)";
      
      let remaining = seconds;
      updateTimeoutMessage(remaining);
      
      lockTimeout = setInterval(() => {
        remaining--;
        updateTimeoutMessage(remaining);
        
        if (remaining <= 0) {
          unlockSystem();
        }
      }, 1000);
    }
    
    function updateTimeoutMessage(seconds) {
      timeoutDiv.textContent = `‚è∞ System locked. Try again in ${seconds} seconds...`;
      timeoutDiv.style.opacity = '1';
      timeoutDiv.style.color = "#ff8a8a";
    }
    
    function unlockSystem() {
      clearInterval(lockTimeout);
      isLocked = false;
      passwordInput.disabled = false;
      submitBtn.disabled = false;
      passwordInput.style.borderColor = "#6c8cff";
      passwordInput.style.backgroundColor = "rgba(30, 30, 45, 0.8)";
      timeoutDiv.style.opacity = '0';
      timeoutDiv.textContent = '';
      attemptsRemaining = 5;
      updateAttemptCounter();
    }
    
    function updateAttemptCounter() {
      attemptCounter.textContent = `Attempts remaining: ${attemptsRemaining}`;
    }
    
    // ‰øÆÂæ©Á≠îÊ°àËº∏ÂÖ•ÈôêÂà∂
    function restrictPasswordInput() {
      // Âè™ÂÖÅË®±Ëº∏ÂÖ•Êï∏Â≠ó
      passwordInput.addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // ÈôêÂà∂Âè™ËÉΩËº∏ÂÖ•‰∏ÄÂÄãÂ≠óÁ¨¶
        if (this.value.length > 1) {
          this.value = this.value.charAt(0);
        }
      });
      
      // Èò≤Ê≠¢Á≤òË≤ºÈùûÊï∏Â≠óÂÖßÂÆπ
      passwordInput.addEventListener('paste', function(e) {
        e.preventDefault();
        const pastedText = (e.clipboardData || window.clipboardData).getData('text');
        const numbersOnly = pastedText.replace(/[^0-9]/g, '');
        if (numbersOnly.length > 0) {
          this.value = numbersOnly.charAt(0);
        }
      });
    }
    
    // Answer verification - correct answer set to 7
    const CORRECT_ANSWER = "7";
    
    function checkPassword() {
      // Èò≤Ê≠¢ÈáçË§áÊèê‰∫§
      if (!canSubmit) return;
      canSubmit = false;
      
      if (isLocked) {
        resultDiv.textContent = "‚ùå System is locked. Please wait...";
        resultDiv.className = "result error";
        resultDiv.style.opacity = '1';
        setTimeout(() => { canSubmit = true; }, 1000);
        return;
      }
      
      const input = passwordInput;
      
      const userAnswer = input.value.trim();
      
      resultDiv.style.opacity = '0';
      timeoutDiv.style.opacity = '0';
      
      if (!userAnswer) {
        resultDiv.textContent = "Please enter password!";
        resultDiv.className = "result error";
        resultDiv.style.opacity = '1';
        setTimeout(() => { canSubmit = true; }, 1000);
        return;
      }
      
      if (!/^[0-9]$/.test(userAnswer)) {
        resultDiv.textContent = "Password must be a 0-9 digit!";
        resultDiv.className = "result error";
        resultDiv.style.opacity = '1';
        setTimeout(() => { canSubmit = true; }, 1000);
        return;
      }
      
      if (userAnswer === CORRECT_ANSWER) {
        resultDiv.textContent = "‚úÖ Congratulations! Temporal anchor locked, password correct!";
        resultDiv.className = "result success";
        resultDiv.style.opacity = '1';
        input.style.borderColor = "#4caf50";
        input.style.boxShadow = "0 0 20px rgba(76, 175, 80, 0.5)";
        input.style.backgroundColor = "rgba(30, 45, 30, 0.8)";
        
        // Disable further attempts
        passwordInput.disabled = true;
        submitBtn.disabled = true;
        submitBtn.textContent = "Completed ‚úì";
        submitBtn.style.background = "linear-gradient(135deg, #2e7d32 0%, #4caf50 100%)";
        
        canSubmit = true;
      } else {
        attemptsRemaining--;
        updateAttemptCounter();
        
        resultDiv.textContent = `‚ùå Password incorrect! ${attemptsRemaining} attempts remaining`;
        resultDiv.className = "result error";
        resultDiv.style.opacity = '1';
        input.style.borderColor = "#f44336";
        input.style.boxShadow = "0 0 20px rgba(244, 67, 54, 0.5)";
        input.style.backgroundColor = "rgba(60, 30, 30, 0.8)";
        
        // Clear input after delay
        setTimeout(() => {
          input.value = '';
          input.style.borderColor = "#6c8cff";
          input.style.boxShadow = "none";
          input.style.backgroundColor = "rgba(30, 30, 45, 0.8)";
        }, 2000);
        
        // ÊÅ¢Âæ©Êèê‰∫§ËÉΩÂäõ
        setTimeout(() => { canSubmit = true; }, 1000);
        
        // Lock system if no attempts remaining
        if (attemptsRemaining <= 0) {
          setTimeout(() => {
            lockSystem(30); // Lock for 30 seconds
          }, 500);
        }
      }
    }
    
    // Password input events
    passwordInput.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        checkPassword();
        event.preventDefault();
      }
    });
    
    passwordInput.addEventListener('focus', function() {
      if (!isLocked) {
        this.style.borderColor = "#8ab4f8";
        this.style.boxShadow = "0 0 15px rgba(108, 140, 255, 0.5)";
        this.style.transform = "scale(1.05)";
      }
    });
    
    passwordInput.addEventListener('blur', function() {
      this.style.boxShadow = "none";
      this.style.transform = "scale(1)";
    });
    
    // ÂàùÂßãÂåñÂØÜÁ¢ºËº∏ÂÖ•ÈôêÂà∂
    restrictPasswordInput();
    
    // Prevent calculator button events from bubbling to global keyboard events
    document.querySelectorAll('.calc-btn').forEach(button => {
      button.addEventListener('click', function(event) {
        event.stopPropagation();
      });
    });
    
    // Initialize attempt counter
    updateAttemptCounter();
    
    // Keyboard support - fix conflicts
    document.addEventListener('keydown', function(event) {
      const key = event.key;
      const target = event.target;
      
      // If focus is on password input, only handle specific keys
      if (target === passwordInput) {
        if (key === 'Enter' && !isLocked) {
          checkPassword();
          event.preventDefault();
        }
        // Allow number input if not locked
        if (/^[0-9]$/.test(key) && !isLocked) {
          // Allow normal input
          return;
        }
        // ÈòªÊ≠¢ÂÖ∂‰ªñÊåâÈçµ
        if (!['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(key)) {
          event.preventDefault();
        }
        event.stopPropagation();
        return;
      }
      
      // When focus is not on password input, handle calculator keys
      // Number input
      if (/^[0-9]$/.test(key)) {
        appendToScreen(key);
        event.preventDefault();
      }
      // Operator input
      else if (['+', '-', '*', '/'].includes(key)) {
        appendToScreen(key);
        event.preventDefault();
      }
      // Decimal point
      else if (key === '.') {
        appendToScreen('.');
        event.preventDefault();
      }
      // Parentheses
      else if (key === '(' || key === ')') {
        appendToScreen(key);
        event.preventDefault();
      }
      // Enter key for calculation
      else if (key === 'Enter') {
        calculate();
        event.preventDefault();
      }
      // Escape key to clear
      else if (key === 'Escape') {
        clearScreen();
        event.preventDefault();
      }
      // Backspace key to delete
      else if (key === 'Backspace') {
        deleteLast();
        event.preventDefault();
      }
    });
  </script>
</body>
</html>